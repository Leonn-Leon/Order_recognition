# order_recognition/core/category_mapper.py

CATEGORY_MAP = {
    'арматура': ['арматура', 'арматурный'],
    'труба_профильная': ['труба профильная', 'профтруба', 'труба пр', 'труба оц пр'],
    'труба_круглая': ['труба', 'труба вгп', 'труба эс', 'труба оц'],
    'лист': ['лист', 'лист г/к', 'лист х/к', 'лист оц', 'лист пвл', 'лист риф'],
    'швеллер': ['швеллер'],
    'уголок': ['уголок'],
    'балка': ['балка'],
    'круг': ['круг'],
    'квадрат': ['квадрат'],
    'полоса': ['полоса'],
    'проволока': ['проволока'],
    'сетка': ['сетка'],
    'профнастил': ['профнастил', 'профлист'],
    'металлочерепица': ['металлочерепица'],
    'сэндвич-панель': ['сэндвич-панель', 'сэндвич панель', 'сэндвич'],
    'доборный_элемент': ['доборный элемент', 'доборные элементы', 'планка'],
}

VALID_CAT1 = [
    'Сорт', 'Лист', 'КиФ', 'Профили', 'Труба', 'Лента (штрипс)', 'Фасон'
]

def get_base_name(category_string: str) -> str | None:
    """
    Определяет канонический base_name по строке с названием категории.
    """
    if not isinstance(category_string, str):
        return None
        
    cat_lower = category_string.lower()
    for base_name, keywords in CATEGORY_MAP.items():
        for keyword in keywords:
            if keyword in cat_lower:
                return base_name
    return None

def get_canonical_base_names() -> list[str]:
    """Возвращает список всех канонических имен для промпта Gemini."""
    return list(CATEGORY_MAP.keys())